<h2 class="upload-title">Upload de Imagem do Contador</h2>

<div style="text-align: center; margin-bottom: 20px;">
<<<<<<< HEAD
  <img src="/qrcode.png" alt="QR Code" style="width: 180px; height: 180px;" />
=======
  <img src="qrcode2.png" alt="QR Code" style="width: 180px; height: 180px;" />
>>>>>>> main
  <p>Escaneie este QR Code para dispositivos móveis para abrir a página.</p>
</div>

<div style="margin-bottom: 20px;">
  <input matInput type="file" accept="image/*" capture="environment" (change)="onFileSelected($event)" />
</div>

<div *ngIf="imagemPreviewUrl" style="margin-bottom: 20px; text-align:center;">
  <img [src]="imagemPreviewUrl" alt="Preview da Imagem" style="max-width: 100%; max-height: 300px; border-radius: 6px; box-shadow: 0 0 8px rgba(0,0,0,0.2);" />
</div>

<div style="margin-bottom: 20px;">
  <button mat-raised-button (click)="processarOCR()" [disabled]="!imagemSelecionada" color="primary">
    Processar OCR
  </button>
</div>

<div *ngIf="mensagem" style="color: red; margin-bottom: 15px;">
  {{ mensagem }}
</div>

<div *ngIf="textoOCR" style="margin-bottom: 20px;">
  <h4>Texto extraído do OCR:</h4>
  <pre>{{ textoOCR }}</pre>
</div>

<p *ngIf="valorExtraido !== null" style="margin-bottom: 20px;">
  Valor extraído: <strong>{{ valorExtraido }}</strong> kWh
</p>

<div *ngIf="podeMostrarBotaoSalvar" style="margin-bottom: 20px;">
  <mat-label>Corrija o valor se necessário:</mat-label>
  <mat-form-field style="width: 100%;">
    <input matInput type="number" [(ngModel)]="valorCorrigido" />
  </mat-form-field>
</div>
<form class="form-ocr" (ngSubmit)="salvarLeitura()" #form="ngForm">
  <mat-form-field style="width: 100%; margin-bottom: 10px;">
    <mat-label>Estado:</mat-label>
    <mat-select
      [(ngModel)]="estadoSelecionadoId"
      (ngModelChange)="estadoSelecionadoId = $event === '' ? null : +$event"
      name="estado"
      required
    >
      <mat-option value="" selected>Selecione um estado</mat-option>
      <mat-option *ngFor="let estado of estados" [value]="estado.id">{{ estado.nome }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field style="width: 100%; margin-bottom: 10px;">
    <mat-label>Bandeira:</mat-label>
    <mat-select
      [(ngModel)]="bandeiraSelecionadaId"
      (ngModelChange)="bandeiraSelecionadaId = $event === '' ? null : +$event"
      name="bandeira"
      required
    >
      <mat-option value="" selected>Selecione uma bandeira</mat-option>
      <mat-option *ngFor="let bandeira of bandeiras" [value]="bandeira.id">
        {{ bandeira.cor }} - {{ bandeira.descricao }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <div style="margin-bottom: 20px;">
    <mat-checkbox [(ngModel)]="tarifaSocial" name="tarifaSocial">Tarifa Social</mat-checkbox>
  </div>

  <button mat-raised-button
          type="submit"
          *ngIf="podeMostrarBotaoSalvar"
          [disabled]="!podeSalvar"
          color="accent"
          style="width: 100%;">
    Salvar Leitura
  </button>
</form>

<div style="text-align: center; margin-top: 20px;">
  <button mat-raised-button (click)="irParaLeituras()" color="primary">
    Ir para Lista de Leituras
  </button>
</div>
